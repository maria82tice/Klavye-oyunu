<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klavye UstasÄ± - 5. SÄ±nÄ±f Klavye Ã–ÄŸrenme Oyunu</title>
    <style>
        /* ===== GENEL TANIMLAMALAR ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(37, 99, 235, 0.2);
            max-width: 1000px;
            width: 100%;
            padding: 30px;
            position: relative;
        }

        /* ===== BAÅLIK VE BUTONLAR ===== */
        h1 {
            color: #1e40af;
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 20px;
        }

        h2 {
            color: #2563eb;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }

        .subtitle {
            text-align: center;
            color: #64748b;
            font-size: 1.1rem;
            margin-bottom: 30px;
        }

        button {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            box-shadow: 0 4px 15px rgba(100, 116, 139, 0.3);
        }

        button.danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        /* ===== EKRAN BÃ–LÃœMLERI ===== */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== ANA MENÃœ ===== */
        .menu-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .menu-buttons button {
            padding: 20px;
            font-size: 1.2rem;
            height: auto;
        }

        /* ===== ETAP SEÃ‡Ä°MÄ° ===== */
        .stage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stage-card {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .stage-card:hover {
            transform: translateY(-5px);
            border-color: #2563eb;
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
        }

        .stage-card h3 {
            color: #1e40af;
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .stage-card p {
            color: #475569;
            font-size: 0.95rem;
        }

        /* ===== OYUN ALANI ===== */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px;
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-radius: 12px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.2rem;
            color: #1e40af;
            font-weight: 600;
        }

        .stat-icon {
            font-size: 1.5rem;
        }

        /* ===== OYUN Ä°Ã‡ERÄ°ÄÄ° ===== */
        .game-content {
            min-height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            background: #f8fafc;
            border-radius: 15px;
            position: relative;
        }

        .question {
            font-size: 1.8rem;
            color: #1e293b;
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 700px;
        }

        .key-display {
            font-size: 4rem;
            color: #2563eb;
            font-weight: bold;
            padding: 40px 60px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(37, 99, 235, 0.2);
            border: 4px solid #2563eb;
            margin: 20px 0;
        }

        .hint {
            font-size: 1.2rem;
            color: #64748b;
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: #fef3c7;
            border-radius: 10px;
            border-left: 4px solid #f59e0b;
        }

        /* ===== DÃœÅEN TUÅLAR MOD ===== */
        #fallingArea {
            width: 100%;
            height: 400px;
            position: relative;
            overflow: hidden;
            background: linear-gradient(180deg, #dbeafe 0%, #f8fafc 100%);
            border-radius: 15px;
            border: 3px solid #2563eb;
        }

        .falling-key {
            position: absolute;
            font-size: 2.5rem;
            font-weight: bold;
            color: #1e40af;
            background: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
            border: 3px solid #2563eb;
            animation: fall linear;
        }

        @keyframes fall {
            from { top: -60px; }
            to { top: 100%; }
        }

        /* ===== GERÄ° BÄ°LDÄ°RÄ°M ===== */
        .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px 50px;
            border-radius: 20px;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            z-index: 1000;
            animation: feedbackPop 0.5s ease;
            pointer-events: none;
        }

        .feedback.correct {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 10px 40px rgba(16, 185, 129, 0.4);
        }

        .feedback.wrong {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 10px 40px rgba(239, 68, 68, 0.4);
        }

        @keyframes feedbackPop {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        /* ===== OYUN SONU ===== */
        .game-over {
            text-align: center;
        }

        .score-display {
            font-size: 3rem;
            color: #2563eb;
            font-weight: bold;
            margin: 30px 0;
        }

        .stats-list {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: left;
        }

        .stats-list h3 {
            color: #1e40af;
            margin-bottom: 15px;
        }

        .stats-list li {
            color: #475569;
            font-size: 1.1rem;
            margin: 10px 0;
            padding-left: 10px;
        }

        /* ===== YARDIM VE Ã–ÄRETÄ°M MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ef4444;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 1.3rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .help-section {
            margin: 20px 0;
        }

        .help-section h3 {
            color: #1e40af;
            margin-bottom: 10px;
        }

        .help-section p, .help-section li {
            color: #475569;
            line-height: 1.6;
            margin: 8px 0;
        }

        /* ===== RESPONSÄ°VE TASARIM ===== */
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
            .question { font-size: 1.4rem; }
            .key-display { font-size: 3rem; padding: 30px 40px; }
            .game-header { font-size: 1rem; }
            .container { padding: 20px; }
        }

        /* ===== PROGRESS BAR ===== */
        .progress-container {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #2563eb 0%, #1e40af 100%);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        /* ===== COMBO INDICATOR ===== */
        .combo {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
            animation: pulse 0.5s ease infinite;
            display: none;
        }

        .combo.active {
            display: block;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* ===== TUÅLARA BASILDIÄINDA EFEKTÄ° ===== */
        .pressed-key {
            animation: keyPress 0.3s ease;
        }

        @keyframes keyPress {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        /* ===== GÃ–RSEL KLAVYE (ETAP 1) ===== */
        .visual-keyboard {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            padding: 25px;
            border-radius: 15px;
            max-width: 1100px;
            margin: 20px auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            display: flex;
            gap: 20px;
        }

        .keyboard-main {
            flex: 1;
        }

        .keyboard-numpad {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .keyboard-row {
            display: flex;
            gap: 6px;
            margin-bottom: 6px;
        }

        .key-button {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 1px solid #94a3b8;
            border-bottom: 3px solid #64748b;
            border-radius: 5px;
            padding: 8px;
            min-width: 50px;
            height: 50px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #1e293b;
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            position: relative;
        }

        .key-button:hover {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-color: #2563eb;
            border-bottom-color: #1e40af;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3);
        }

        .key-button:active {
            transform: translateY(1px);
            border-bottom-width: 1px;
        }

        .key-button.correct {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%) !important;
            border-color: #10b981 !important;
            border-bottom-color: #059669 !important;
            animation: correctPulse 0.5s ease;
        }

        .key-button.wrong {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%) !important;
            border-color: #ef4444 !important;
            border-bottom-color: #dc2626 !important;
            animation: shake 0.5s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1) translateY(0); }
            50% { transform: scale(1.1) translateY(-3px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
        }

        /* TuÅŸ boyutlarÄ± */
        .key-1u { min-width: 50px; }
        .key-1-5u { min-width: 75px; }
        .key-1-75u { min-width: 87px; }
        .key-2u { min-width: 100px; }
        .key-2-25u { min-width: 112px; }
        .key-2-75u { min-width: 137px; }
        .key-6-25u { min-width: 312px; }

        /* Ã–zel tuÅŸ stilleri */
        .key-button .key-label {
            font-size: 0.85rem;
        }

        .key-button .key-secondary {
            font-size: 0.65rem;
            color: #64748b;
            margin-top: 2px;
        }

        /* NumPad Ã¶zel stil */
        .key-numpad {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }

        .key-numpad:hover {
            background: linear-gradient(135deg, #fde68a 0%, #fcd34d 100%);
        }

        /* ===== SEVÄ°YE GÃ–STERGESI ===== */
        .level-badge {
            display: inline-block;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ANA MENÃœ -->
        <div id="mainMenu" class="screen active">
            <h1>ğŸ® Klavye UstasÄ±</h1>
            <p class="subtitle">5. SÄ±nÄ±f BiliÅŸim Teknolojileri - Klavye Ã–ÄŸrenme Oyunu</p>
            <div class="menu-buttons">
                <button onclick="showStageSelect()">ğŸ¯ Etap SeÃ§ ve Oyna</button>
                <button onclick="showHelp()" class="secondary">â“ YardÄ±m</button>
                <button onclick="toggleSound()" class="secondary" id="soundButton">
                    <span id="soundIcon">ğŸ”Š</span> Ses: <span id="soundStatus">AÃ§Ä±k</span>
                </button>
            </div>
            <div style="margin-top: 40px; text-align: center; padding-top: 20px; border-top: 2px solid #e2e8f0;">
                <p style="color: #64748b; font-size: 0.95rem; margin-bottom: 5px;">
                    TasarÄ±m ve GeliÅŸtirme
                </p>
                <p style="color: #2563eb; font-size: 1.1rem; font-weight: 600;">
                    Maria TEKEL
                </p>
            </div>
        </div>

        <!-- ETAP SEÃ‡Ä°MÄ° -->
        <div id="stageSelect" class="screen">
            <h2>Etap SeÃ§imi</h2>
            <p class="subtitle">Ä°stediÄŸin etaptan baÅŸlayabilirsin!</p>
            <div class="stage-grid">
                <div class="stage-card" onclick="startStage(1)">
                    <h3>ğŸ“ Etap 1</h3>
                    <p>TanÄ±ma & GÃ¶rev Bul</p>
                    <p style="font-size: 0.85rem; margin-top: 10px;">TuÅŸun gÃ¶revini okuyup doÄŸru tuÅŸa bas</p>
                </div>
                <div class="stage-card" onclick="startStage(2)">
                    <h3>ğŸ”¤ Etap 2</h3>
                    <p>TuÅŸu GÃ¶r, Bas!</p>
                    <p style="font-size: 0.85rem; margin-top: 10px;">Ekrandaki karakteri klavyede bul</p>
                </div>
                <div class="stage-card" onclick="startStage(3)">
                    <h3>ğŸ¯ Etap 3</h3>
                    <p>DÃ¼ÅŸen TuÅŸlar</p>
                    <p style="font-size: 0.85rem; margin-top: 10px;">DÃ¼ÅŸen tuÅŸlara zamanÄ±nda bas</p>
                </div>
                <div class="stage-card" onclick="startStage(4)">
                    <h3>âŒ¨ï¸ Etap 4</h3>
                    <p>KÄ±sayol GÃ¶ster</p>
                    <p style="font-size: 0.85rem; margin-top: 10px;">GÃ¶sterilen kÄ±sayolu yap</p>
                </div>
                <div class="stage-card" onclick="startStage(5)">
                    <h3>ğŸ§  Etap 5</h3>
                    <p>TanÄ±mdan KÄ±sayol Bul</p>
                    <p style="font-size: 0.85rem; margin-top: 10px;">AÃ§Ä±klamadan kÄ±sayolu hatÄ±rla</p>
                </div>
            </div>
            <button onclick="showMainMenu()" class="secondary">â¬…ï¸ Ana MenÃ¼ye DÃ¶n</button>
        </div>

        <!-- OYUN EKRANI -->
        <div id="gameScreen" class="screen">
            <div class="game-header">
                <div class="stat">
                    <span class="stat-icon">â±ï¸</span>
                    <span>SÃ¼re: <span id="timeDisplay">30</span>s</span>
                </div>
                <div class="stat">
                    <span class="stat-icon">ğŸ¯</span>
                    <span>Skor: <span id="scoreDisplay">0</span></span>
                </div>
                <div class="stat">
                    <span class="stat-icon">â¤ï¸</span>
                    <span>Can: <span id="livesDisplay">3</span></span>
                </div>
                <div class="stat">
                    <span class="stat-icon">ğŸ“Š</span>
                    <span>Seviye: <span id="levelDisplay">1</span></span>
                </div>
            </div>
            <div class="game-content" id="gameContent">
                <!-- Oyun iÃ§eriÄŸi buraya dinamik olarak eklenecek -->
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button onclick="exitGame()" class="danger">ğŸšª Oyundan Ã‡Ä±k</button>
            </div>
        </div>

        <!-- OYUN SONU EKRANI -->
        <div id="gameOverScreen" class="screen">
            <div class="game-over">
                <h2 id="gameOverTitle">ğŸ® Oyun Bitti!</h2>
                <div class="score-display" id="finalScore">0</div>
                <div class="stats-list">
                    <h3>ğŸ“Š Ä°statistikler</h3>
                    <ul id="statsContent"></ul>
                </div>
                <div id="mistakesList" class="stats-list" style="display: none;">
                    <h3>âš ï¸ En Ã‡ok ZorlandÄ±ÄŸÄ±n TuÅŸlar</h3>
                    <ul id="mistakesContent"></ul>
                </div>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
                    <button onclick="retryStage()">ğŸ”„ Tekrar Dene</button>
                    <button onclick="showStageSelect()" class="secondary">ğŸ“‹ Etap SeÃ§</button>
                    <button onclick="showMainMenu()" class="secondary">ğŸ  Ana MenÃ¼</button>
                </div>
            </div>
        </div>
    </div>

    <!-- YARDIM MODAL -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeHelp()">Ã—</button>
            <h2>â“ YardÄ±m</h2>
            <div class="help-section">
                <h3>ğŸ® Oyun NasÄ±l OynanÄ±r?</h3>
                <p>Klavye UstasÄ±, klavye kullanÄ±mÄ±nÄ± Ã¶ÄŸrenmen iÃ§in tasarlanmÄ±ÅŸ eÄŸlenceli bir oyundur. 5 farklÄ± etap var:</p>
                <ul>
                    <li><strong>Etap 1:</strong> TuÅŸun gÃ¶revini okuyup doÄŸru tuÅŸa basacaksÄ±n</li>
                    <li><strong>Etap 2:</strong> Ekranda gÃ¶sterilen harfi veya karakteri klavyede bulacaksÄ±n</li>
                    <li><strong>Etap 3:</strong> YukarÄ±dan dÃ¼ÅŸen tuÅŸlara zamanÄ±nda basacaksÄ±n</li>
                    <li><strong>Etap 4:</strong> GÃ¶sterilen klavye kÄ±sayolunu yapacaksÄ±n (Ã¶rn: Ctrl+C)</li>
                    <li><strong>Etap 5:</strong> AÃ§Ä±klamadan kÄ±sayolu hatÄ±rlayÄ±p yapacaksÄ±n</li>
                </ul>
            </div>
            <div class="help-section">
                <h3>ğŸ’¡ Ä°puÃ§larÄ±</h3>
                <ul>
                    <li>HÄ±zdan Ã§ok <strong>doÄŸruluk</strong> Ã¶nemli - acele etme!</li>
                    <li>Her tuÅŸa saygÄ±lÄ± ve dikkatli davran</li>
                    <li>YanlÄ±ÅŸ tuÅŸa basarsan can kaybedersin (3 can hakkÄ±n var)</li>
                    <li>SÃ¼re biterse soru yanlÄ±ÅŸ sayÄ±lÄ±r</li>
                    <li>3+ doÄŸru peÅŸ peÅŸe combo bonusu kazandÄ±rÄ±r! ğŸ”¥</li>
                    <li>Seviye arttÄ±kÃ§a oyun zorlaÅŸÄ±r ama sen yaparsÄ±n! ğŸ’ª</li>
                </ul>
            </div>
            <div class="help-section">
                <h3>ğŸ¯ Puanlama</h3>
                <p>DoÄŸru ve hÄ±zlÄ± cevaplar daha Ã§ok puan kazandÄ±rÄ±r. Kalan sÃ¼re Ã— 10 + combo bonusu alÄ±rsÄ±n!</p>
            </div>
            <div class="help-section">
                <h3>ğŸ“š EÄŸitim Ä°Ã§eriÄŸi</h3>
                <p>MEB 5. SÄ±nÄ±f BiliÅŸim Teknolojileri mÃ¼fredatÄ±na uygun ÅŸekilde tasarlanmÄ±ÅŸtÄ±r.</p>
                <p style="margin-top: 15px; padding: 10px; background: #dbeafe; border-radius: 8px; border-left: 4px solid #2563eb;">
                    <strong>ğŸ’¡ Ä°pucu:</strong> Klavyene bakmadan, hissederek tuÅŸlarÄ± bulmaya Ã§alÄ±ÅŸ!
                </p>
            </div>
        </div>
    </div>

    <!-- COMBO GÃ–STERGESI -->
    <div id="comboIndicator" class="combo">
        ğŸ”¥ Combo: <span id="comboCount">0</span>
    </div>

    <script>
        // ===== GLOBAL DEÄÄ°ÅKENLER =====
        let currentStage = 0;
        let currentLevel = 1;
        let score = 0;
        let lives = 3;
        let timeRemaining = 30;
        let timerInterval = null;
        let combo = 0;
        let maxCombo = 0;
        
        // Ayarlar
        let soundEnabled = true;
        
        // Ä°statistikler
        let questionsAnswered = 0;
        let correctAnswers = 0;
        let wrongAnswers = 0;
        let mistakes = {}; // Hangi tuÅŸlarda hata yapÄ±ldÄ±ÄŸÄ±nÄ± takip eder
        
        // Oyun durumu
        let currentQuestion = null;
        let pressedKeys = new Set(); // Åu anda basÄ±lÄ± olan tuÅŸlar
        let waitingForCombo = false; // KÄ±sayol kombinasyonu bekleniyor mu?
        let expectedCombo = null; // Beklenen kÄ±sayol kombinasyonu
        let gameStartTime = 0; // Oyun baÅŸlangÄ±Ã§ zamanÄ±
        let totalPlayTime = 0; // Toplam oyun sÃ¼resi (saniye)
        let isGameOver = false; // GLOBAL oyun bitti flag'i - tÃ¼m iÅŸlemleri durdurur
        
        // DÃ¼ÅŸen tuÅŸlar modu iÃ§in
        let fallingKeysInterval = null;
        let activeKeys = [];
        let lastFallingKeys = []; // Son dÃ¼ÅŸen tuÅŸlarÄ± hatÄ±rla (tekrar Ã¶nlemek iÃ§in)
        
        // ===== KLAVYE VERÄ° BANKASI =====
        
        // Ã–zel tuÅŸlar ve gÃ¶revleri - tam klavye
        const specialKeys = {
            'Escape': 'Ä°ptal tuÅŸu, Ã§Ä±kÄ±ÅŸ yapar, bazÄ± programlarda menÃ¼den Ã§Ä±kÄ±lÄ±r',
            'F1': 'YardÄ±m menÃ¼sÃ¼nÃ¼ aÃ§ar',
            'F2': 'Dosya veya klasÃ¶rÃ¼ yeniden adlandÄ±rÄ±r',
            'F3': 'Arama yapar',
            'F4': 'Adres Ã§ubuÄŸunu aÃ§ar',
            'F5': 'SayfayÄ± yeniler',
            'F6': 'TarayÄ±cÄ± adres Ã§ubuÄŸuna gider',
            'Tab': 'YazÄ± programÄ±nda sekme/boÅŸluk bÄ±rakÄ±r, tablolarda hÃ¼creler arasÄ± geÃ§iÅŸ yapar',
            'CapsLock': 'Tamamen bÃ¼yÃ¼k veya kÃ¼Ã§Ã¼k harf yazmayÄ± aÃ§Ä±p kapatÄ±r (kilit)',
            'Shift': 'Harfleri geÃ§ici olarak bÃ¼yÃ¼k yazar, Ã¼stteki ikinci karakteri yazar',
            'Control': 'KÄ±sayollarda diÄŸer tuÅŸlarla birlikte kullanÄ±lÄ±r',
            'Alt': 'Pencere deÄŸiÅŸtirme ve kÄ±sayollarda kullanÄ±lÄ±r',
            'Space': 'Kelimeler arasÄ±nda boÅŸluk bÄ±rakÄ±r',
            'AltGraph': 'TuÅŸ Ã¼zerindeki Ã¼Ã§Ã¼ncÃ¼/alt karakteri yazar (@ â‚¬ gibi)',
            'Enter': 'Onay tuÅŸu, metinde alt satÄ±ra geÃ§irir',
            'Backspace': 'Ä°mlecin solundaki karakteri siler',
            'Delete': 'SeÃ§ili Ã¶ÄŸeyi siler, metinde imlecin saÄŸÄ±nÄ± siler',
            'Insert': 'Ekleme/Ã¼zerine yazma modunu deÄŸiÅŸtirir',
            'Home': 'SatÄ±r baÅŸÄ±na veya sayfanÄ±n en Ã¼stÃ¼ne gider',
            'End': 'SatÄ±r sonuna veya sayfanÄ±n en altÄ±na gider',
            'PageUp': 'EkranÄ± bir sayfa yukarÄ± kaydÄ±rÄ±r',
            'PageDown': 'EkranÄ± bir sayfa aÅŸaÄŸÄ± kaydÄ±rÄ±r',
            'ArrowUp': 'YukarÄ± ok tuÅŸu, imleci yukarÄ± taÅŸÄ±r',
            'ArrowDown': 'AÅŸaÄŸÄ± ok tuÅŸu, imleci aÅŸaÄŸÄ± taÅŸÄ±r',
            'ArrowLeft': 'Sol ok tuÅŸu, imleci sola taÅŸÄ±r',
            'ArrowRight': 'SaÄŸ ok tuÅŸu, imleci saÄŸa taÅŸÄ±r',
            'NumLock': 'SaÄŸdaki sayÄ± tuÅŸ takÄ±mÄ±nÄ± aÃ§ar/kapatÄ±r (kilit)'
        };
        
        // Klavye kÄ±sayollarÄ± - pencere iÅŸlemleri kaldÄ±rÄ±ldÄ± (N, W, T gerÃ§ekten pencere aÃ§Ä±p kapatÄ±yor)
        const shortcuts = [
            { keys: ['Control', 'x'], name: 'Ctrl + X', description: 'SeÃ§ili metni keser' },
            { keys: ['Control', 'c'], name: 'Ctrl + C', description: 'SeÃ§ili metni kopyalar' },
            { keys: ['Control', 'v'], name: 'Ctrl + V', description: 'Kopyalanan metni yapÄ±ÅŸtÄ±rÄ±r' },
            { keys: ['Control', 's'], name: 'Ctrl + S', description: 'DosyayÄ± kaydeder' },
            { keys: ['Control', 'p'], name: 'Ctrl + P', description: 'YazdÄ±rma menÃ¼sÃ¼nÃ¼ aÃ§ar' },
            { keys: ['Control', 'a'], name: 'Ctrl + A', description: 'TÃ¼mÃ¼nÃ¼ seÃ§er' },
            { keys: ['Control', 'f'], name: 'Ctrl + F', description: 'Sayfa iÃ§inde arama yapar' },
            { keys: ['Control', 'z'], name: 'Ctrl + Z', description: 'Son iÅŸlemi geri alÄ±r' },
            { keys: ['Control', 'y'], name: 'Ctrl + Y', description: 'Geri alÄ±nan iÅŸlemi yineler' },
            { keys: ['Control', 'b'], name: 'Ctrl + B', description: 'Metni kalÄ±n yapar' },
            { keys: ['Control', 'u'], name: 'Ctrl + U', description: 'Metnin altÄ±nÄ± Ã§izer' },
            { keys: ['Control', 'i'], name: 'Ctrl + I', description: 'Metni italik yapar' },
            { keys: ['Control', 'h'], name: 'Ctrl + H', description: 'Bul ve deÄŸiÅŸtir' },
            { keys: ['Control', 'k'], name: 'Ctrl + K', description: 'BaÄŸlantÄ± ekler' },
            { keys: ['Control', 'd'], name: 'Ctrl + D', description: 'SayfayÄ± yer imlerine ekler' }
        ];
        
        // Harfler ve sayÄ±lar (Shift kombinasyonlarÄ± dahil)
        const characters = [
            // KÃ¼Ã§Ã¼k harfler
            'a', 'b', 'c', 'Ã§', 'd', 'e', 'f', 'g', 'ÄŸ', 'h', 'Ä±', 'i', 'j', 'k', 'l', 'm', 
            'n', 'o', 'Ã¶', 'p', 'r', 's', 'ÅŸ', 't', 'u', 'Ã¼', 'v', 'y', 'z',
            // SayÄ±lar
            '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',
            // Noktalama iÅŸaretleri
            '.', ',', ';', ':', '-', '(', ')', '!', '?', '/', '+', '=', '*'
        ];
        
        // BÃ¼yÃ¼k harfler ve Ã¶zel karakterler iÃ§in Shift kombinasyonlarÄ±
        const shiftCharacters = [
            { display: 'A', keys: ['Shift', 'a'] },
            { display: 'B', keys: ['Shift', 'b'] },
            { display: 'C', keys: ['Shift', 'c'] },
            { display: 'D', keys: ['Shift', 'd'] },
            { display: 'E', keys: ['Shift', 'e'] },
            { display: 'Ä', keys: ['Shift', 'ÄŸ'] },
            { display: 'Ãœ', keys: ['Shift', 'Ã¼'] },
            { display: 'Å', keys: ['Shift', 'ÅŸ'] },
            { display: 'Ä°', keys: ['Shift', 'i'] },
            { display: 'Ã–', keys: ['Shift', 'Ã¶'] },
            { display: '?', keys: ['Shift', ','] },
            { display: '!', keys: ['Shift', '1'] },
            { display: ':', keys: ['Shift', '.'] },
            { display: '"', keys: ['Shift', '\''] },
            { display: '(', keys: ['Shift', '8'] },
            { display: ')', keys: ['Shift', '9'] },
            { display: '_', keys: ['Shift', '-'] },
            { display: '%', keys: ['Shift', '5'] },
            { display: '&', keys: ['Shift', '6'] },
            { display: '\'', keys: ['Shift', ','] }
        ];
        
        // ===== SES EFEKTLERÄ° =====
        
        // Web Audio API ile basit ses efektleri oluÅŸtur
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (!soundEnabled) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'correct') {
                // DoÄŸru cevap - yÃ¼kselen ton
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.exponentialRampToValueAtTime(783.99, audioContext.currentTime + 0.1); // G5
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            } else if (type === 'wrong') {
                // YanlÄ±ÅŸ cevap - alÃ§alan ton
                oscillator.frequency.setValueAtTime(392.00, audioContext.currentTime); // G4
                oscillator.frequency.exponentialRampToValueAtTime(196.00, audioContext.currentTime + 0.15); // G3
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.25);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.25);
            } else if (type === 'gameover') {
                // Oyun bitti - dÃ¼ÅŸen ton dizisi
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(261.63, audioContext.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.4);
            } else if (type === 'levelup') {
                // Seviye atladÄ± - yÃ¼kselen arpej
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.4);
            }
        }
        
        // ===== EKRAN GEÃ‡Ä°ÅLERÄ° =====
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }
        
        function showMainMenu() {
            resetGame();
            showScreen('mainMenu');
        }
        
        function showStageSelect() {
            showScreen('stageSelect');
        }
        
        function showHelp() {
            document.getElementById('helpModal').classList.add('active');
        }
        
        function closeHelp() {
            document.getElementById('helpModal').classList.remove('active');
        }
        
        // ===== SES KONTROLÃœ =====
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const icon = document.getElementById('soundIcon');
            const status = document.getElementById('soundStatus');
            
            if (soundEnabled) {
                icon.textContent = 'ğŸ”Š';
                status.textContent = 'AÃ§Ä±k';
            } else {
                icon.textContent = 'ğŸ”‡';
                status.textContent = 'KapalÄ±';
            }
        }
        
        // ===== OYUN BAÅLATMA VE YÃ–NETÄ°MÄ° =====
        
        function startStage(stageNum) {
            currentStage = stageNum;
            resetGame();
            showScreen('gameScreen');
            
            // Etapa gÃ¶re oyunu baÅŸlat
            if (stageNum === 1) {
                startStage1(); // TanÄ±ma & GÃ¶rev Bul
            } else if (stageNum === 2) {
                startStage2(); // TuÅŸu GÃ¶r, Bas!
            } else if (stageNum === 3) {
                startStage3(); // DÃ¼ÅŸen TuÅŸlar
            } else if (stageNum === 4) {
                startStage4(); // KÄ±sayol GÃ¶ster
            } else if (stageNum === 5) {
                startStage5(); // TanÄ±mdan KÄ±sayol Bul
            }
        }
        
        function resetGame() {
            currentLevel = 1;
            score = 0;
            lives = 3;
            timeRemaining = 30;
            questionsAnswered = 0;
            correctAnswers = 0;
            wrongAnswers = 0;
            combo = 0;
            maxCombo = 0;
            mistakes = {};
            activeKeys = [];
            gameStartTime = Date.now();
            totalPlayTime = 0;
            isGameOver = false; // Oyun durumunu sÄ±fÄ±rla
            
            clearInterval(timerInterval);
            clearInterval(fallingKeysInterval);
            
            updateDisplay();
        }
        
        function updateDisplay() {
            document.getElementById('timeDisplay').textContent = timeRemaining;
            document.getElementById('scoreDisplay').textContent = score;
            document.getElementById('livesDisplay').textContent = lives;
            document.getElementById('levelDisplay').textContent = currentLevel;
            
            // Combo gÃ¶stergesi
            if (combo >= 3) {
                document.getElementById('comboCount').textContent = combo;
                document.getElementById('comboIndicator').classList.add('active');
            } else {
                document.getElementById('comboIndicator').classList.remove('active');
            }
        }
        
        function startTimer(duration) {
            // Oyun bittiyse timer baÅŸlatma
            if (isGameOver) return;
            
            timeRemaining = duration;
            updateDisplay();
            
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                // Oyun bittiyse timer'Ä± durdur
                if (isGameOver) {
                    clearInterval(timerInterval);
                    return;
                }
                
                timeRemaining--;
                updateDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    
                    // Etap 1'de sÃ¼re biterse ve kilit yoksa
                    if (currentStage === 1 && !stage1AnswerLocked && !isGameOver) {
                        stage1AnswerLocked = true;
                        handleWrongAnswer('SÃ¼re doldu');
                        
                        // Oyun bittiyse yeni soru gÃ¶sterme
                        if (isGameOver || lives <= 0) {
                            return;
                        }
                        
                        // 2 saniye sonra yeni soruya geÃ§
                        setTimeout(() => {
                            if (!isGameOver && lives > 0) {
                                stage1AnswerLocked = false;
                                showStage1Question();
                            }
                        }, 2000);
                    } else if (currentStage !== 1 && !isGameOver) {
                        // DiÄŸer etaplar iÃ§in normal akÄ±ÅŸ
                        handleWrongAnswer();
                    }
                }
            }, 1000);
        }
        
        function exitGame() {
            // Ã–NCE oyun durumunu sonlandÄ±r
            isGameOver = true;
            
            // TÃ¼m interval'leri temizle
            clearInterval(timerInterval);
            clearInterval(fallingKeysInterval);
            
            // TÃ¼m event listener'larÄ± temizle (sadece tanÄ±mlÄ± olanlar)
            document.removeEventListener('keydown', stage2KeyHandler);
            document.removeEventListener('keydown', stage2ComboHandler);
            document.removeEventListener('keyup', stage2ComboKeyUp);
            document.removeEventListener('keydown', stage3KeyHandler);
            document.removeEventListener('keydown', stage4ComboHandler);
            document.removeEventListener('keyup', stage4ComboKeyUp);
            document.removeEventListener('keydown', stage5ComboHandler);
            document.removeEventListener('keyup', stage5ComboKeyUp);
            
            // Aktif tuÅŸlarÄ± temizle
            activeKeys = [];
            lastFallingKeys = [];
            pressedKeys.clear();
            
            // Etap 1 kilidini kaldÄ±r
            stage1AnswerLocked = false;
            
            showStageSelect();
        }
        
        // ===== GERÄ° BÄ°LDÄ°RÄ°M =====
        
        function showFeedback(isCorrect, message = null) {
            const feedback = document.createElement('div');
            feedback.className = `feedback ${isCorrect ? 'correct' : 'wrong'}`;
            feedback.textContent = message || (isCorrect ? 'âœ“ DoÄŸru!' : 'âœ— YanlÄ±ÅŸ!');
            document.body.appendChild(feedback);
            
            playSound(isCorrect ? 'correct' : 'wrong');
            
            setTimeout(() => {
                feedback.remove();
            }, 1000);
        }
        
        function handleCorrectAnswer(points = null) {
            correctAnswers++;
            combo++;
            if (combo > maxCombo) maxCombo = combo;
            
            // Puan hesapla: Kalan sÃ¼re Ã— 10 + combo bonusu
            const timeBonus = timeRemaining * 10;
            const comboBonus = combo >= 3 ? combo * 20 : 0;
            const totalPoints = points || (timeBonus + comboBonus);
            
            score += totalPoints;
            updateDisplay();
            showFeedback(true);
            
            // Etap 1 iÃ§in nextQuestion Ã§aÄŸÄ±rma (kendi setTimeout'u var)
            if (currentStage !== 1) {
                // Bir sonraki soruya geÃ§
                setTimeout(() => {
                    nextQuestion();
                }, 1000);
            }
        }
        
        function handleWrongAnswer(mistakeKey = null) {
            // Oyun zaten bittiyse hiÃ§bir ÅŸey yapma
            if (isGameOver) return;
            
            wrongAnswers++;
            lives--;
            combo = 0; // Combo sÄ±fÄ±rlanÄ±r
            
            if (mistakeKey) {
                mistakes[mistakeKey] = (mistakes[mistakeKey] || 0) + 1;
            }
            
            updateDisplay();
            showFeedback(false);
            
            // Can 0 veya altÄ±na dÃ¼ÅŸtÃ¼yse oyunu bitir
            if (lives <= 0) {
                isGameOver = true;
                clearInterval(timerInterval);
                // HEMEN game over - setTimeout YOK
                gameOver();
                return;
            }
            
            // Etap 1 iÃ§in nextQuestion Ã§aÄŸÄ±rma (kendi setTimeout'u var)
            if (currentStage !== 1) {
                // Bir sonraki soruya geÃ§
                setTimeout(() => {
                    if (!isGameOver && lives > 0) {
                        nextQuestion();
                    }
                }, 1000);
            }
        }
        
        function gameOver() {
            // Zaten oyun bittiyse tekrar Ã§aÄŸÄ±rma
            if (isGameOver && document.getElementById('gameOverScreen').classList.contains('active')) {
                return;
            }
            
            // Oyun durumunu kesinlikle sonlandÄ±r
            isGameOver = true;
            
            // TÃ¼m interval'leri temizle
            clearInterval(timerInterval);
            clearInterval(fallingKeysInterval);
            
            // TÃ¼m event listener'larÄ± temizle (sadece tanÄ±mlÄ± olanlar)
            document.removeEventListener('keydown', stage2KeyHandler);
            document.removeEventListener('keydown', stage2ComboHandler);
            document.removeEventListener('keyup', stage2ComboKeyUp);
            document.removeEventListener('keydown', stage3KeyHandler);
            document.removeEventListener('keydown', stage4ComboHandler);
            document.removeEventListener('keyup', stage4ComboKeyUp);
            document.removeEventListener('keydown', stage5ComboHandler);
            document.removeEventListener('keyup', stage5ComboKeyUp);
            
            // Etap 1 kilidini kaldÄ±r
            stage1AnswerLocked = false;
            
            playSound('gameover');
            
            // Ä°statistikleri hazÄ±rla
            totalPlayTime = Math.floor((Date.now() - gameStartTime) / 1000);
            const minutes = Math.floor(totalPlayTime / 60);
            const seconds = totalPlayTime % 60;
            
            document.getElementById('gameOverTitle').textContent = 'ğŸ® Oyun Bitti!';
            document.getElementById('finalScore').textContent = `â±ï¸ ${minutes}:${seconds.toString().padStart(2, '0')} Dakika`;
            
            const statsContent = document.getElementById('statsContent');
            statsContent.innerHTML = `
                <li>â±ï¸ Toplam SÃ¼re: ${minutes} dakika ${seconds} saniye</li>
                <li>ğŸ¯ Toplam Puan: ${score}</li>
                <li>ğŸ“ Toplam Soru: ${questionsAnswered}</li>
                <li>âœ… DoÄŸru Cevap: ${correctAnswers}</li>
                <li>âŒ YanlÄ±ÅŸ Cevap: ${wrongAnswers}</li>
                <li>ğŸ”¥ En YÃ¼ksek Combo: ${maxCombo}</li>
                <li>ğŸ“Š BaÅŸarÄ± OranÄ±: ${questionsAnswered > 0 ? Math.round((correctAnswers / questionsAnswered) * 100) : 0}%</li>
                <li>ğŸ† UlaÅŸÄ±lan Seviye: ${currentLevel}</li>
            `;
            
            // En Ã§ok zorlanÄ±lan tuÅŸlarÄ± gÃ¶ster
            const mistakeEntries = Object.entries(mistakes).sort((a, b) => b[1] - a[1]).slice(0, 5);
            if (mistakeEntries.length > 0) {
                const mistakesContent = document.getElementById('mistakesContent');
                mistakesContent.innerHTML = mistakeEntries.map(([key, count]) => 
                    `<li><strong>${key}</strong>: ${count} hata</li>`
                ).join('');
                document.getElementById('mistakesList').style.display = 'block';
            } else {
                document.getElementById('mistakesList').style.display = 'none';
            }
            
            showScreen('gameOverScreen');
        }
        
        function retryStage() {
            startStage(currentStage);
        }
        
        // ===== ETAP 1: GÃ–RSEL KLAVYEDE TIK TIKLA =====
        
        let stage1Questions = [];
        let stage1CurrentIndex = 0;
        let stage1CorrectKey = null;
        let stage1AnswerLocked = false; // Cevap verildi mi kontrolÃ¼
        
        // GerÃ§ek Q TÃ¼rkÃ§e klavye dÃ¼zeni
        const keyboardLayout = {
            main: [
                // Ãœst sÄ±ra - F tuÅŸlarÄ± ve Ã¶zel tuÅŸlar
                [
                    { id: 'Escape', label: 'Esc', size: '1u' },
                    { id: 'F1', label: 'F1', size: '1u' },
                    { id: 'F2', label: 'F2', size: '1u' },
                    { id: 'F3', label: 'F3', size: '1u' },
                    { id: 'F4', label: 'F4', size: '1u' },
                    { id: 'F5', label: 'F5', size: '1u' },
                    { id: 'F6', label: 'F6', size: '1u' },
                    { id: 'Insert', label: 'Ins', size: '1u' },
                    { id: 'Delete', label: 'Del', size: '1u' },
                    { id: 'Home', label: 'Home', size: '1u' },
                    { id: 'End', label: 'End', size: '1u' },
                    { id: 'PageUp', label: 'PgUp', size: '1u' },
                    { id: 'PageDown', label: 'PgDn', size: '1u' }
                ],
                // SayÄ± sÄ±rasÄ±
                [
                    { id: 'Digit1', label: '1', secondary: '!', size: '1u' },
                    { id: 'Digit2', label: '2', secondary: '\'', size: '1u' },
                    { id: 'Digit3', label: '3', secondary: '^', size: '1u' },
                    { id: 'Digit4', label: '4', secondary: '+', size: '1u' },
                    { id: 'Digit5', label: '5', secondary: '%', size: '1u' },
                    { id: 'Digit6', label: '6', secondary: '&', size: '1u' },
                    { id: 'Digit7', label: '7', secondary: '/', size: '1u' },
                    { id: 'Digit8', label: '8', secondary: '(', size: '1u' },
                    { id: 'Digit9', label: '9', secondary: ')', size: '1u' },
                    { id: 'Digit0', label: '0', secondary: '=', size: '1u' },
                    { id: 'Minus', label: '*', secondary: '?', size: '1u' },
                    { id: 'Equal', label: '-', secondary: '_', size: '1u' },
                    { id: 'Backspace', label: 'âŒ«', secondary: 'Backspace', size: '2u' }
                ],
                // QWERTY sÄ±rasÄ±
                [
                    { id: 'Tab', label: 'Tab', secondary: 'â‡¥', size: '1-5u' },
                    { id: 'KeyQ', label: 'Q', size: '1u' },
                    { id: 'KeyW', label: 'W', size: '1u' },
                    { id: 'KeyE', label: 'E', size: '1u' },
                    { id: 'KeyR', label: 'R', size: '1u' },
                    { id: 'KeyT', label: 'T', size: '1u' },
                    { id: 'KeyY', label: 'Y', size: '1u' },
                    { id: 'KeyU', label: 'U', size: '1u' },
                    { id: 'KeyI', label: 'I', size: '1u' },
                    { id: 'KeyO', label: 'O', size: '1u' },
                    { id: 'KeyP', label: 'P', size: '1u' },
                    { id: 'BracketLeft', label: 'Ä', size: '1u' },
                    { id: 'BracketRight', label: 'Ãœ', size: '1u' },
                    { id: 'Enter', label: 'Enter', secondary: 'â', size: '1-5u' }
                ],
                // ASDF sÄ±rasÄ±
                [
                    { id: 'CapsLock', label: 'Caps', secondary: 'Lock', size: '1-75u' },
                    { id: 'KeyA', label: 'A', size: '1u' },
                    { id: 'KeyS', label: 'S', size: '1u' },
                    { id: 'KeyD', label: 'D', size: '1u' },
                    { id: 'KeyF', label: 'F', size: '1u' },
                    { id: 'KeyG', label: 'G', size: '1u' },
                    { id: 'KeyH', label: 'H', size: '1u' },
                    { id: 'KeyJ', label: 'J', size: '1u' },
                    { id: 'KeyK', label: 'K', size: '1u' },
                    { id: 'KeyL', label: 'L', size: '1u' },
                    { id: 'Semicolon', label: 'Å', size: '1u' },
                    { id: 'Quote', label: 'Ä°', size: '1u' },
                    { id: 'Backslash', label: ',', secondary: ';', size: '1u' }
                ],
                // ZXCV sÄ±rasÄ±
                [
                    { id: 'Shift', label: 'Shift', secondary: 'â‡§', size: '2-25u' },
                    { id: 'KeyZ', label: 'Z', size: '1u' },
                    { id: 'KeyX', label: 'X', size: '1u' },
                    { id: 'KeyC', label: 'C', size: '1u' },
                    { id: 'KeyV', label: 'V', size: '1u' },
                    { id: 'KeyB', label: 'B', size: '1u' },
                    { id: 'KeyN', label: 'N', size: '1u' },
                    { id: 'KeyM', label: 'M', size: '1u' },
                    { id: 'Comma', label: 'Ã–', size: '1u' },
                    { id: 'Period', label: 'Ã‡', size: '1u' },
                    { id: 'Slash', label: '.', secondary: ':', size: '1u' },
                    { id: 'ArrowUp', label: 'â†‘', size: '1u' }
                ],
                // Alt sÄ±ra
                [
                    { id: 'Control', label: 'Ctrl', size: '1-5u' },
                    { id: 'Alt', label: 'Alt', size: '1-5u' },
                    { id: 'Space', label: 'Space', size: '6-25u' },
                    { id: 'AltGraph', label: 'AltGr', size: '1-5u' },
                    { id: 'ArrowLeft', label: 'â†', size: '1u' },
                    { id: 'ArrowDown', label: 'â†“', size: '1u' },
                    { id: 'ArrowRight', label: 'â†’', size: '1u' }
                ]
            ],
            numpad: [
                [
                    { id: 'NumLock', label: 'Num', secondary: 'Lock', size: '1u', isNumpad: true },
                    { id: 'NumpadDivide', label: '/', size: '1u', isNumpad: true },
                    { id: 'NumpadMultiply', label: '*', size: '1u', isNumpad: true },
                    { id: 'NumpadSubtract', label: '-', size: '1u', isNumpad: true }
                ],
                [
                    { id: 'Numpad7', label: '7', size: '1u', isNumpad: true },
                    { id: 'Numpad8', label: '8', size: '1u', isNumpad: true },
                    { id: 'Numpad9', label: '9', size: '1u', isNumpad: true },
                    { id: 'NumpadAdd', label: '+', size: '1u', isNumpad: true }
                ],
                [
                    { id: 'Numpad4', label: '4', size: '1u', isNumpad: true },
                    { id: 'Numpad5', label: '5', size: '1u', isNumpad: true },
                    { id: 'Numpad6', label: '6', size: '1u', isNumpad: true }
                ],
                [
                    { id: 'Numpad1', label: '1', size: '1u', isNumpad: true },
                    { id: 'Numpad2', label: '2', size: '1u', isNumpad: true },
                    { id: 'Numpad3', label: '3', size: '1u', isNumpad: true },
                    { id: 'NumpadEnter', label: 'Enter', size: '1u', isNumpad: true }
                ],
                [
                    { id: 'Numpad0', label: '0', size: '2u', isNumpad: true },
                    { id: 'NumpadDecimal', label: '.', size: '1u', isNumpad: true }
                ]
            ]
        };
        
        function startStage1() {
            // SorularÄ± hazÄ±rla ve karÄ±ÅŸtÄ±r
            stage1Questions = Object.entries(specialKeys).map(([key, description]) => ({
                key: key,
                description: description
            }));
            
            // Rastgele karÄ±ÅŸtÄ±r
            for (let i = stage1Questions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [stage1Questions[i], stage1Questions[j]] = [stage1Questions[j], stage1Questions[i]];
            }
            
            stage1CurrentIndex = 0;
            
            showStage1Question();
        }
        
        function showStage1Question() {
            // Ã–NCE oyun durumu kontrolÃ¼ - isGameOver true ise hiÃ§bir ÅŸey yapma
            if (isGameOver) {
                return;
            }
            
            // Can kontrolÃ¼ - 0 veya altÄ±ndaysa oyun bitir ve yeni soru gÃ¶sterme
            if (lives <= 0) {
                if (!isGameOver) {
                    isGameOver = true;
                    gameOver();
                }
                return;
            }
            
            // Sorular bittiyse yeniden karÄ±ÅŸtÄ±r
            if (stage1CurrentIndex >= stage1Questions.length) {
                for (let i = stage1Questions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [stage1Questions[i], stage1Questions[j]] = [stage1Questions[j], stage1Questions[i]];
                }
                stage1CurrentIndex = 0;
                currentLevel++;
                updateDisplay();
                playSound('levelup');
                showFeedback(true, `ğŸ‰ Seviye ${currentLevel}!`);
            }
            
            questionsAnswered++;
            currentQuestion = stage1Questions[stage1CurrentIndex];
            stage1CorrectKey = currentQuestion.key;
            stage1CurrentIndex++;
            
            // Toplam sÃ¼reyi gÃ¼ncelle
            totalPlayTime = Math.floor((Date.now() - gameStartTime) / 1000);
            
            // GÃ¶rsel klavyeyi oluÅŸtur
            let keyboardHTML = '<div class="visual-keyboard">';
            
            // Ana klavye
            keyboardHTML += '<div class="keyboard-main">';
            keyboardLayout.main.forEach(row => {
                keyboardHTML += '<div class="keyboard-row">';
                row.forEach(key => {
                    const sizeClass = `key-${key.size}`;
                    const secondaryLabel = key.secondary ? `<div class="key-secondary">${key.secondary}</div>` : '';
                    keyboardHTML += `
                        <button class="key-button ${sizeClass}" 
                                data-key="${key.id}" 
                                onclick="checkStage1Key('${key.id}')">
                            <div class="key-label">${key.label}</div>
                            ${secondaryLabel}
                        </button>
                    `;
                });
                keyboardHTML += '</div>';
            });
            keyboardHTML += '</div>';
            
            // Numpad
            keyboardHTML += '<div class="keyboard-numpad">';
            keyboardLayout.numpad.forEach(row => {
                keyboardHTML += '<div class="keyboard-row">';
                row.forEach(key => {
                    const sizeClass = `key-${key.size}`;
                    const numpadClass = key.isNumpad ? 'key-numpad' : '';
                    const secondaryLabel = key.secondary ? `<div class="key-secondary">${key.secondary}</div>` : '';
                    keyboardHTML += `
                        <button class="key-button ${sizeClass} ${numpadClass}" 
                                data-key="${key.id}" 
                                onclick="checkStage1Key('${key.id}')">
                            <div class="key-label">${key.label}</div>
                            ${secondaryLabel}
                        </button>
                    `;
                });
                keyboardHTML += '</div>';
            });
            keyboardHTML += '</div>';
            
            keyboardHTML += '</div>';
            
            // Soruyu gÃ¶ster
            document.getElementById('gameContent').innerHTML = `
                <div class="question">${currentQuestion.description}</div>
                <div class="hint">ğŸ‘† Klavye Ã¼zerinde doÄŸru tuÅŸa tÄ±kla veya dokun!</div>
                ${keyboardHTML}
                <div style="margin-top: 20px; font-size: 1.1rem; color: #2563eb;">
                    â±ï¸ Oyun SÃ¼resi: ${totalPlayTime} saniye
                </div>
            `;
            
            startTimer(30);
            stage1AnswerLocked = false; // Yeni soru baÅŸladÄ±, kilidi aÃ§
        }
        
        function checkStage1Key(clickedKey) {
            // Ã–NCE oyun durumu kontrolÃ¼ - isGameOver true ise hiÃ§bir ÅŸey yapma
            if (isGameOver) {
                return;
            }
            
            // Ã–NCELÄ°KLE can kontrolÃ¼ - 0 veya altÄ±ndaysa gameOver gÃ¶ster
            if (lives <= 0) {
                if (!isGameOver) {
                    isGameOver = true;
                    clearInterval(timerInterval);
                    gameOver();
                }
                return;
            }
            
            // EÄŸer cevap kilitliyse (zaten cevaplandÄ±ysa) iÅŸlem yapma
            if (stage1AnswerLocked) {
                return;
            }
            
            // CevabÄ± kilitle - tekrar tÄ±klanamaz
            stage1AnswerLocked = true;
            clearInterval(timerInterval);
            
            const keyButton = document.querySelector(`[data-key="${clickedKey}"]`);
            
            if (clickedKey === stage1CorrectKey) {
                // DoÄŸru!
                if (keyButton) keyButton.classList.add('correct');
                handleCorrectAnswer();
                
                // Oyun bittiyse yeni soru gÃ¶sterme
                if (isGameOver) return;
                
                // 1 saniye sonra yeni soruya geÃ§
                setTimeout(() => {
                    if (!isGameOver && lives > 0) {
                        stage1AnswerLocked = false;
                        showStage1Question();
                    }
                }, 1000);
            } else {
                // YanlÄ±ÅŸ!
                if (keyButton) keyButton.classList.add('wrong');
                
                // 0.3 saniye sonra doÄŸru tuÅŸu gÃ¶ster
                setTimeout(() => {
                    if (!isGameOver) {
                        const correctButton = document.querySelector(`[data-key="${stage1CorrectKey}"]`);
                        if (correctButton) {
                            correctButton.classList.add('correct');
                        }
                    }
                }, 300);
                
                // Ã–NCE can azalt - handleWrongAnswer iÃ§inde isGameOver kontrolÃ¼ yapÄ±lÄ±yor
                // handleWrongAnswer lives<=0 ise HEMEN gameOver Ã§aÄŸÄ±rÄ±r ve isGameOver=true yapar
                handleWrongAnswer(clickedKey);
                
                // Oyun bittiyse (handleWrongAnswer iÃ§inde ayarlandÄ±) yeni soru gÃ¶sterme
                if (isGameOver) {
                    return; // handleWrongAnswer zaten gameOver Ã§aÄŸÄ±rdÄ±
                }
                
                // 2 saniye sonra yeni soruya geÃ§
                setTimeout(() => {
                    if (!isGameOver && lives > 0) {
                        stage1AnswerLocked = false;
                        showStage1Question();
                    }
                }, 2000);
            }
        }
        
        // Stage1KeyHandler artÄ±k kullanÄ±lmÄ±yor - gÃ¶rsel klavye ile tÄ±klama yapÄ±lÄ±yor
        
        function nextQuestion() {
            if (currentStage === 1) {
                showStage1Question();
            } else if (currentStage === 2) {
                showStage2Question();
            } else if (currentStage === 4) {
                showStage4Question();
            } else if (currentStage === 5) {
                showStage5Question();
            }
            
            // Seviye atlama kontrolÃ¼ (her 5 soruda bir)
            if (questionsAnswered % 5 === 0) {
                currentLevel++;
                updateDisplay();
                playSound('levelup');
                showFeedback(true, `ğŸ‰ Seviye ${currentLevel}!`);
            }
        }
        
        // ===== ETAP 2: TUÅU GÃ–R, BAS! =====
        
        let stage2Questions = [];
        let stage2CurrentIndex = 0;
        
        function startStage2() {
            // Karakterleri zorluÄŸa gÃ¶re sÄ±rala - ama Shift/AltGr karakterler ERKEN gelsin
            const easyChars = characters.filter(c => /[a-z0-9]/i.test(c)).slice(0, 10);
            const mediumChars = characters.filter(c => /[Ã§ÄŸÄ±Ã¶ÅŸÃ¼]/i.test(c));
            const specialChars = [';', ')', '(', ':', '?', '!', '"', '_', '%', '&'];
            
            // Ã–NEMLÄ°: Shift karakterleri ve Ã¶zel karakterleri BAÅA ekle
            const shiftCharsEarly = shiftCharacters.slice(0, 10);
            
            stage2Questions = [
                // Ä°LK OLARAK Shift ve Ã¶zel karakterler (Ã¶ÄŸrenmek iÃ§in zaman olsun)
                ...shiftCharsEarly,
                ...specialChars.map(c => ({ display: c, keys: [c], isShift: false })),
                // Sonra kolay karakterler
                ...easyChars.map(c => ({ display: c, keys: [c], isShift: false })),
                ...mediumChars.map(c => ({ display: c, keys: [c], isShift: false })),
                // Kalan Shift karakterler
                ...shiftCharacters.slice(10)
            ];
            
            stage2Questions.sort(() => Math.random() - 0.5);
            stage2CurrentIndex = 0;
            
            showStage2Question();
        }
        
        function showStage2Question() {
            // Can kontrolÃ¼
            if (lives <= 0) {
                gameOver();
                return;
            }
            
            // Sorular bittiyse yeniden karÄ±ÅŸtÄ±r
            if (stage2CurrentIndex >= stage2Questions.length) {
                stage2Questions.sort(() => Math.random() - 0.5);
                stage2CurrentIndex = 0;
                currentLevel++;
                updateDisplay();
                playSound('levelup');
                showFeedback(true, `ğŸ‰ Seviye ${currentLevel}!`);
            }
            
            questionsAnswered++;
            currentQuestion = stage2Questions[stage2CurrentIndex];
            stage2CurrentIndex++;
            
            // Toplam sÃ¼reyi gÃ¼ncelle
            totalPlayTime = Math.floor((Date.now() - gameStartTime) / 1000);
            
            // Shift/AltGr hatÄ±rlatmasÄ±
            let hintText = 'âŒ¨ï¸ Ekrandaki tuÅŸa bas!';
            let reminderBox = '';
            
            if (currentQuestion.keys.length > 1) {
                hintText = 'ğŸ’¡ Ä°pucu: Bu bÃ¼yÃ¼k harf veya Ã¶zel karakter iÃ§in Shift tuÅŸunu kullanman gerekebilir!';
                reminderBox = `
                    <div style="background: #fef3c7; padding: 15px; border-radius: 10px; margin-top: 20px; border-left: 4px solid #f59e0b;">
                        <strong style="color: #92400e;">ğŸ“Œ HatÄ±rlatma:</strong>
                        <span style="color: #78350f;"> Shift tuÅŸuna basÄ±lÄ± tutarken harfe bas!</span>
                    </div>
                `;
            } else if ([';', ')', '(', ':', '?', '!', '"', '_', '%', '&', '@', 'â‚¬', 'â‚º'].includes(currentQuestion.display)) {
                reminderBox = `
                    <div style="background: #dbeafe; padding: 15px; border-radius: 10px; margin-top: 20px; border-left: 4px solid #2563eb;">
                        <strong style="color: #1e40af;">ğŸ“Œ HatÄ±rlatma:</strong>
                        <span style="color: #1e3a8a;"> Ã–zel karakterler iÃ§in Shift veya AltGr tuÅŸu gerekebilir!</span>
                    </div>
                `;
            }
            
            document.getElementById('gameContent').innerHTML = `
                <div class="key-display">${currentQuestion.display}</div>
                <div class="hint">${hintText}</div>
                ${reminderBox}
                <div style="margin-top: 20px; font-size: 1.1rem; color: #2563eb;">
                    â±ï¸ Oyun SÃ¼resi: ${totalPlayTime} saniye
                </div>
            `;
            
            const duration = Math.max(15, 25 - currentLevel * 2);
            startTimer(duration);
            
            // Ã–nceki event listener'larÄ± temizle
            document.removeEventListener('keydown', stage2KeyHandler);
            document.removeEventListener('keydown', stage2ComboHandler);
            document.removeEventListener('keyup', stage2ComboKeyUp);
            
            if (currentQuestion.keys.length > 1) {
                // Shift kombinasyonu gerekiyor
                pressedKeys.clear();
                waitingForCombo = true;
                document.addEventListener('keydown', stage2ComboHandler);
                document.addEventListener('keyup', stage2ComboKeyUp);
            } else {
                // Tek tuÅŸ
                document.addEventListener('keydown', stage2KeyHandler);
            }
        }
        
        function stage2KeyHandler(e) {
            e.preventDefault();
            
            // Oyun bittiyse iÅŸlem yapma
            if (isGameOver) return;
            
            // Sadece Shift, Alt, AltGr, Ctrl tuÅŸlarÄ±na basÄ±lÄ±rsa yanlÄ±ÅŸ sayma - kombinasyon bekliyor olabilir
            if (['Shift', 'Alt', 'Control', 'AltGraph'].includes(e.key)) {
                return; // Bu tuÅŸlarÄ± yoksay, yanlÄ±ÅŸ sayma
            }
            
            document.removeEventListener('keydown', stage2KeyHandler);
            clearInterval(timerInterval);
            
            // Tek tuÅŸ sorularÄ±nda BÃœYÃœK/KÃœÃ‡ÃœK HARF Ã¶nemli deÄŸil (sadece kÃ¼Ã§Ã¼k harfler sorulduÄŸu iÃ§in)
            // Ama eÄŸer Ã¶zel karakter soruluyorsa tam eÅŸleÅŸme gerekir
            const expectedKey = currentQuestion.keys[0];
            const pressedKey = e.key;
            
            // Harf mi kontrol et
            const isLetter = /^[a-zA-ZÃ§Ã‡ÄŸÄÄ±Ä°Ã¶Ã–ÅŸÅÃ¼Ãœ]$/.test(expectedKey);
            
            let isCorrect = false;
            if (isLetter) {
                // Harfler iÃ§in bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k farketmez
                isCorrect = pressedKey.toLowerCase() === expectedKey.toLowerCase();
            } else {
                // Ã–zel karakterler iÃ§in tam eÅŸleÅŸme
                isCorrect = pressedKey === expectedKey;
            }
            
            if (isCorrect) {
                handleCorrectAnswer();
            } else {
                handleWrongAnswer(e.key);
            }
        }
        
        function stage2ComboHandler(e) {
            e.preventDefault();
            
            // Oyun bittiyse iÅŸlem yapma
            if (isGameOver) return;
            
            // Shift, Alt, AltGr, Ctrl tek baÅŸÄ±na basÄ±ldÄ±ÄŸÄ±nda sadece kaydet, hata verme
            if (['Shift', 'Alt', 'Control', 'AltGraph'].includes(e.key)) {
                pressedKeys.add(e.key);
                return; // HenÃ¼z kontrol etme, ikinci tuÅŸu bekle
            }
            
            pressedKeys.add(e.key);
            
            // Shift + karakter kontrolÃ¼
            const expectedChar = currentQuestion.keys[1];
            
            // Shift basÄ±lÄ± mÄ± kontrol et (shiftKey veya Set'te 'Shift')
            const isShiftPressed = e.shiftKey || pressedKeys.has('Shift');
            
            // Event listener'larÄ± temizle
            document.removeEventListener('keydown', stage2ComboHandler);
            document.removeEventListener('keyup', stage2ComboKeyUp);
            clearInterval(timerInterval);
            
            if (isShiftPressed) {
                // DoÄŸru kombinasyon mu kontrol et
                let isCorrect = false;
                
                // Direkt karakter kontrolÃ¼ (tarayÄ±cÄ± otomatik bÃ¼yÃ¼k harf vb. yapÄ±yor)
                if (e.key === currentQuestion.display) {
                    isCorrect = true;
                } else {
                    // Manuel kontrol (kÃ¼Ã§Ã¼k harfle karÅŸÄ±laÅŸtÄ±r)
                    const pressedChar = e.key.toLowerCase();
                    const expectedLower = expectedChar.toLowerCase();
                    isCorrect = (pressedChar === expectedLower);
                }
                
                if (isCorrect) {
                    handleCorrectAnswer();
                } else {
                    handleWrongAnswer(Array.from(pressedKeys).join('+'));
                }
            } else {
                // Shift basÄ±lÄ± deÄŸilken karakter tuÅŸuna basÄ±ldÄ± - YANLIÅ
                // BÃ¼yÃ¼k harf isteniyorsa ve kÃ¼Ã§Ã¼k basÄ±ldÄ±ysa yanlÄ±ÅŸ
                handleWrongAnswer(e.key + ' (Shift gerekli!)');
            }
            
            // pressedKeys'i temizle
            pressedKeys.clear();
        }
        
        function stage2ComboKeyUp(e) {
            pressedKeys.delete(e.key);
        }
        
        // ===== ETAP 3: DÃœÅEN TUÅLAR =====
        
        function startStage3() {
            // Ã–nceki event listener'larÄ± ve interval'leri temizle
            document.removeEventListener('keydown', stage3KeyHandler);
            clearInterval(fallingKeysInterval);
            activeKeys = [];
            lastFallingKeys = [];
            
            document.getElementById('gameContent').innerHTML = `
                <div class="level-badge">Seviye ${currentLevel}</div>
                <div id="fallingArea"></div>
                <div class="hint">âŒ¨ï¸ DÃ¼ÅŸen tuÅŸlara zamanÄ±nda bas!</div>
            `;
            
            // SÃ¼rekli oyun modu - timer kullanma
            updateDisplay();
            
            // DÃ¼ÅŸen tuÅŸlarÄ± baÅŸlat
            startFallingKeys();
            
            // Klavye dinleyicisi
            document.addEventListener('keydown', stage3KeyHandler);
        }
        
        function startFallingKeys() {
            clearInterval(fallingKeysInterval);
            
            const spawnInterval = Math.max(1500, 3000 - currentLevel * 200);
            
            fallingKeysInterval = setInterval(() => {
                if (lives <= 0) {
                    clearInterval(fallingKeysInterval);
                    gameOver();
                    return;
                }
                
                // Yeni dÃ¼ÅŸen tuÅŸ oluÅŸtur
                spawnFallingKey();
            }, spawnInterval);
        }
        
        function spawnFallingKey() {
            const container = document.getElementById('fallingArea');
            if (!container) return;
            
            // KullanÄ±labilir Ã¶zel tuÅŸlar (ok tuÅŸlarÄ± sembol olarak gÃ¶sterilecek)
            const specialKeyPool = [
                { display: 'Esc', key: 'Escape' },
                { display: 'Tab', key: 'Tab' },
                { display: 'Enter', key: 'Enter' },
                { display: 'âŒ«', key: 'Backspace' },
                { display: 'Del', key: 'Delete' },
                { display: 'â†‘', key: 'ArrowUp' },
                { display: 'â†“', key: 'ArrowDown' },
                { display: 'â†', key: 'ArrowLeft' },
                { display: 'â†’', key: 'ArrowRight' },
                { display: 'â£', key: ' ' },  // BoÅŸluk tuÅŸu
                { display: 'AltGr', key: 'AltGraph' }  // AltGr tuÅŸu
            ];
            
            // Rastgele karakter seÃ§ (seviyeye gÃ¶re) - ERKEN SEVÄ°YELERDE ZOR KARAKTERLER EKLE
            let charData;
            if (currentLevel === 1) {
                // Seviye 1: Basit harfler + Shift karakterleri (Ã¶ÄŸrensinler)
                const easyChars = characters.filter(c => /[a-z0-9]/i.test(c)).slice(0, 15);
                const earlyShiftChars = shiftCharacters.slice(0, 5).map(s => ({ display: s.display, key: s.keys[1] }));
                const pool = [...easyChars.map(c => ({ display: c, key: c })), ...earlyShiftChars];
                charData = pool[Math.floor(Math.random() * pool.length)];
            } else if (currentLevel === 2) {
                // Seviye 2: TÃ¼rkÃ§e karakterler + Daha fazla Shift karakterleri
                const pool = [
                    ...characters.slice(0, 30).map(c => ({ display: c, key: c })),
                    ...shiftCharacters.slice(0, 8).map(s => ({ display: s.display, key: s.keys[1] }))
                ];
                charData = pool[Math.floor(Math.random() * pool.length)];
            } else if (currentLevel === 3) {
                // Seviye 3: TÃ¼m karakterler + Ã–zel tuÅŸlar
                const pool = [
                    ...characters.map(c => ({ display: c, key: c })),
                    ...shiftCharacters.map(s => ({ display: s.display, key: s.keys[1] })),
                    ...specialKeyPool.slice(0, 5)
                ];
                charData = pool[Math.floor(Math.random() * pool.length)];
            } else {
                // Seviye 4+: Her ÅŸey dahil
                const pool = [
                    ...characters.map(c => ({ display: c, key: c })),
                    ...shiftCharacters.map(s => ({ display: s.display, key: s.keys[1] })),
                    ...specialKeyPool
                ];
                charData = pool[Math.floor(Math.random() * pool.length)];
            }
            
            // Son dÃ¼ÅŸen 3 tuÅŸtan birine denk gelmemesini saÄŸla
            let attempts = 0;
            while (lastFallingKeys.includes(charData.display) && attempts < 10) {
                if (currentLevel === 1) {
                    const pool = characters.filter(c => /[a-z0-9]/i.test(c)).slice(0, 20);
                    const char = pool[Math.floor(Math.random() * pool.length)];
                    charData = { display: char, key: char };
                } else if (currentLevel === 2) {
                    const pool = [...characters.slice(0, 30)];
                    const char = pool[Math.floor(Math.random() * pool.length)];
                    charData = { display: char, key: char };
                } else if (currentLevel === 3) {
                    const pool = [...characters, ...shiftCharacters.slice(0, 3).map(s => ({ display: s.display, key: s.keys[1] }))];
                    charData = pool[Math.floor(Math.random() * pool.length)];
                    if (typeof charData === 'string') {
                        charData = { display: charData, key: charData };
                    }
                } else {
                    const pool = [
                        ...characters.map(c => ({ display: c, key: c })),
                        ...shiftCharacters.map(s => ({ display: s.display, key: s.keys[1] })),
                        ...specialKeyPool
                    ];
                    charData = pool[Math.floor(Math.random() * pool.length)];
                }
                attempts++;
            }
            
            // Son tuÅŸ listesini gÃ¼ncelle (maksimum 3 tuÅŸ hatÄ±rla)
            lastFallingKeys.push(charData.display);
            if (lastFallingKeys.length > 3) {
                lastFallingKeys.shift();
            }
            
            const keyDiv = document.createElement('div');
            keyDiv.className = 'falling-key';
            keyDiv.textContent = charData.display;
            keyDiv.style.left = Math.random() * (container.offsetWidth - 80) + 'px';
            
            const duration = Math.max(3, 6 - currentLevel * 0.5);
            keyDiv.style.animationDuration = duration + 's';
            
            container.appendChild(keyDiv);
            
            // TuÅŸ nesnesini kaydet
            const keyObj = { element: keyDiv, char: charData.key, display: charData.display, matched: false };
            activeKeys.push(keyObj);
            
            // Animasyon bitince kaldÄ±r
            setTimeout(() => {
                if (!keyObj.matched && container.contains(keyDiv)) {
                    keyDiv.remove();
                    activeKeys = activeKeys.filter(k => k !== keyObj);
                    lives--;
                    updateDisplay();
                    playSound('wrong');
                    
                    if (lives <= 0) {
                        clearInterval(fallingKeysInterval);
                        document.removeEventListener('keydown', stage3KeyHandler);
                        gameOver();
                    }
                }
            }, duration * 1000);
        }
        
        function stage3KeyHandler(e) {
            e.preventDefault();
            
            const pressedKey = e.key;
            
            // AltGr iÃ§in gerÃ§ek kontrol - Windows'ta Ctrl+Alt kombinasyonu!
            const isAltGrPressed = (e.ctrlKey && e.altKey) || 
                                   e.key === 'AltGraph' || 
                                   e.code === 'AltRight';
            
            // Aktif dÃ¼ÅŸen tuÅŸlar arasÄ±nda eÅŸleÅŸme ara (bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf duyarsÄ±z)
            for (let i = 0; i < activeKeys.length; i++) {
                const keyObj = activeKeys[i];
                const keyObjLower = (keyObj.char || '').toLowerCase();
                const pressedLower = (pressedKey || '').toLowerCase();
                
                // AltGraph kontrolÃ¼ ekle
                const isMatch = (keyObjLower === pressedLower) || 
                               (keyObj.char === 'AltGraph' && isAltGrPressed);
                
                if (!keyObj.matched && isMatch) {
                    // EÅŸleÅŸme bulundu!
                    keyObj.matched = true;
                    keyObj.element.remove();
                    activeKeys.splice(i, 1);
                    
                    questionsAnswered++;
                    correctAnswers++;
                    combo++;
                    if (combo > maxCombo) maxCombo = combo;
                    
                    score += 50 + (combo * 10);
                    updateDisplay();
                    playSound('correct');
                    
                    // Seviye atlama
                    if (questionsAnswered % 10 === 0) {
                        currentLevel++;
                        updateDisplay();
                        playSound('levelup');
                        showFeedback(true, `ğŸ‰ Seviye ${currentLevel}!`);
                        
                        // HÄ±zÄ± artÄ±r
                        clearInterval(fallingKeysInterval);
                        startFallingKeys();
                    }
                    
                    break;
                }
            }
        }
        
        // ===== ETAP 4: KISAYOL GÃ–STER =====
        
        let stage4Questions = [];
        let stage4CurrentIndex = 0;
        
        function startStage4() {
            stage4Questions = [...shortcuts];
            stage4Questions.sort(() => Math.random() - 0.5);
            stage4CurrentIndex = 0;
            
            // BaÅŸlangÄ±Ã§ aÃ§Ä±klamasÄ± gÃ¶ster
            document.getElementById('gameContent').innerHTML = `
                <div style="text-align: center; padding: 30px;">
                    <h2 style="color: #2563eb; font-size: 2rem; margin-bottom: 20px;">
                        ğŸ¯ Etap 4: KÄ±sayol GÃ¶ster
                    </h2>
                    <div style="background: #dbeafe; padding: 25px; border-radius: 12px; margin: 20px 0;">
                        <p style="font-size: 1.2rem; color: #1e40af; margin-bottom: 15px;">
                            <strong>NasÄ±l OynanÄ±r?</strong>
                        </p>
                        <p style="font-size: 1rem; color: #475569; line-height: 1.6;">
                            Ekranda gÃ¶sterilen klavye kÄ±sayolunu yap!<br>
                            <strong style="color: #2563eb;">Ne kadar hÄ±zlÄ± olursan o kadar Ã§ok puan!</strong><br>
                            ${shortcuts.length} kÄ±sayol var, hepsini tamamla!
                        </p>
                    </div>
                    <button onclick="showStage4Question()" style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; border: none; padding: 15px 40px; font-size: 1.2rem; border-radius: 12px; cursor: pointer; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);">
                        ğŸš€ BaÅŸla!
                    </button>
                </div>
            `;
        }
        
        function showStage4Question() {
            // Can kontrolÃ¼
            if (lives <= 0) {
                gameOver();
                return;
            }
            
            // TÃœM SORULAR BÄ°TTÄ° - Oyun kazanÄ±ldÄ±!
            if (stage4CurrentIndex >= stage4Questions.length) {
                gameOver();
                return;
            }
            
            questionsAnswered++;
            currentQuestion = stage4Questions[stage4CurrentIndex];
            stage4CurrentIndex++;
            
            // Toplam sÃ¼reyi gÃ¼ncelle
            totalPlayTime = Math.floor((Date.now() - gameStartTime) / 1000);
            
            document.getElementById('gameContent').innerHTML = `
                <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="font-size: 1rem; color: #64748b;">
                        Soru ${questionsAnswered} / ${shortcuts.length}
                    </div>
                </div>
                <div class="question">
                    <div style="font-size: 2.5rem; margin-bottom: 20px;">${currentQuestion.name}</div>
                    <div style="font-size: 1.2rem; color: #64748b;">(${currentQuestion.description})</div>
                </div>
                <div class="hint">âŒ¨ï¸ Bu kÄ±sayolu klavyende yap! HÄ±zlÄ± ol = Daha Ã§ok puan!</div>
            `;
            
            startTimer(30);
            
            pressedKeys.clear();
            expectedCombo = currentQuestion.keys.map(k => k.toLowerCase());
            
            // Ã–nceki event listener'larÄ± temizle
            document.removeEventListener('keydown', stage4ComboHandler);
            document.removeEventListener('keyup', stage4ComboKeyUp);
            
            document.addEventListener('keydown', stage4ComboHandler);
            document.addEventListener('keyup', stage4ComboKeyUp);
        }
        
        function stage4ComboHandler(e) {
            e.preventDefault();
            
            const normalizedKey = e.key.toLowerCase() === 'control' ? 'control' : e.key.toLowerCase();
            
            // Sadece modifier tuÅŸlar (Control, Shift, Alt) tek baÅŸÄ±na basÄ±ldÄ±ysa bekle
            if (normalizedKey === 'control' || normalizedKey === 'shift' || normalizedKey === 'alt') {
                pressedKeys.add(normalizedKey);
                return; // HenÃ¼z kontrol etme, ikinci tuÅŸu bekle
            }
            
            pressedKeys.add(normalizedKey);
            
            // TÃ¼m beklenen tuÅŸlar basÄ±lÄ± mÄ± kontrol et
            const allPressed = expectedCombo.every(key => {
                const checkKey = key.toLowerCase();
                return Array.from(pressedKeys).some(pk => pk.toLowerCase() === checkKey);
            });
            
            if (allPressed && pressedKeys.size >= expectedCombo.length) {
                document.removeEventListener('keydown', stage4ComboHandler);
                document.removeEventListener('keyup', stage4ComboKeyUp);
                clearInterval(timerInterval);
                
                // HÄ±z bonusu: Kalan sÃ¼re Ã— 20 puan
                const speedBonus = timeRemaining * 20;
                handleCorrectAnswer(100 + speedBonus);
            } else if (pressedKeys.size >= expectedCombo.length) {
                // YanlÄ±ÅŸ kombinasyon - hemen hata ver
                document.removeEventListener('keydown', stage4ComboHandler);
                document.removeEventListener('keyup', stage4ComboKeyUp);
                clearInterval(timerInterval);
                handleWrongAnswer(Array.from(pressedKeys).join('+'));
            }
        }
        
        function stage4ComboKeyUp(e) {
            pressedKeys.delete(e.key.toLowerCase());
        }
        
        // ===== ETAP 5: TANIMDAN KISAYOL BUL =====
        
        let stage5Questions = [];
        let stage5CurrentIndex = 0;
        
        function startStage5() {
            stage5Questions = [...shortcuts];
            stage5Questions.sort(() => Math.random() - 0.5);
            stage5CurrentIndex = 0;
            
            // BaÅŸlangÄ±Ã§ aÃ§Ä±klamasÄ± gÃ¶ster
            document.getElementById('gameContent').innerHTML = `
                <div style="text-align: center; padding: 30px;">
                    <h2 style="color: #2563eb; font-size: 2rem; margin-bottom: 20px;">
                        ğŸ§  Etap 5: TanÄ±mdan KÄ±sayol Bul
                    </h2>
                    <div style="background: #dbeafe; padding: 25px; border-radius: 12px; margin: 20px 0;">
                        <p style="font-size: 1.2rem; color: #1e40af; margin-bottom: 15px;">
                            <strong>NasÄ±l OynanÄ±r?</strong>
                        </p>
                        <p style="font-size: 1rem; color: #475569; line-height: 1.6;">
                            Ekranda sadece aÃ§Ä±klama gÃ¶sterilecek!<br>
                            Hangi kÄ±sayol olduÄŸunu hatÄ±rlayÄ±p yap!<br>
                            <strong style="color: #2563eb;">HÄ±zlÄ± cevap = Daha fazla puan!</strong><br>
                            ${shortcuts.length} kÄ±sayol var, hepsini tamamla!
                        </p>
                    </div>
                    <button onclick="showStage5Question()" style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; border: none; padding: 15px 40px; font-size: 1.2rem; border-radius: 12px; cursor: pointer; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);">
                        ğŸš€ BaÅŸla!
                    </button>
                </div>
            `;
        }
        
        function showStage5Question() {
            // Can kontrolÃ¼
            if (lives <= 0) {
                gameOver();
                return;
            }
            
            // TÃœM SORULAR BÄ°TTÄ° - Oyun kazanÄ±ldÄ±!
            if (stage5CurrentIndex >= stage5Questions.length) {
                gameOver();
                return;
            }
            
            questionsAnswered++;
            currentQuestion = stage5Questions[stage5CurrentIndex];
            stage5CurrentIndex++;
            
            // Toplam sÃ¼reyi gÃ¼ncelle
            totalPlayTime = Math.floor((Date.now() - gameStartTime) / 1000);
            
            const hintLevel = Math.min(Math.floor(wrongAnswers / 3), 2);
            let hintText = 'ğŸ§  Hangi kÄ±sayoldu? HatÄ±rlamaya Ã§alÄ±ÅŸ!';
            
            if (hintLevel === 1) {
                hintText = `ğŸ’¡ Ä°pucu: ${currentQuestion.name.split(' + ')[0]} ile baÅŸlÄ±yor`;
            } else if (hintLevel === 2) {
                hintText = `ğŸ’¡ Ä°pucu: KÄ±sayol ${currentQuestion.name}`;
            }
            
            document.getElementById('gameContent').innerHTML = `
                <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="font-size: 1rem; color: #64748b;">
                        Soru ${questionsAnswered} / ${shortcuts.length}
                    </div>
                </div>
                <div class="question">
                    <div style="font-size: 2rem; margin-bottom: 20px;">"${currentQuestion.description}"</div>
                </div>
                <div class="hint">${hintText}</div>
            `;
            
            startTimer(35);
            
            pressedKeys.clear();
            expectedCombo = currentQuestion.keys.map(k => k.toLowerCase());
            
            // Ã–nceki event listener'larÄ± temizle
            document.removeEventListener('keydown', stage5ComboHandler);
            document.removeEventListener('keyup', stage5ComboKeyUp);
            
            document.addEventListener('keydown', stage5ComboHandler);
            document.addEventListener('keyup', stage5ComboKeyUp);
        }
        
        function stage5ComboHandler(e) {
            e.preventDefault();
            
            const normalizedKey = e.key.toLowerCase() === 'control' ? 'control' : e.key.toLowerCase();
            
            // Sadece modifier tuÅŸlar (Control, Shift, Alt) tek baÅŸÄ±na basÄ±ldÄ±ysa bekle
            if (normalizedKey === 'control' || normalizedKey === 'shift' || normalizedKey === 'alt') {
                pressedKeys.add(normalizedKey);
                return; // HenÃ¼z kontrol etme, ikinci tuÅŸu bekle
            }
            
            pressedKeys.add(normalizedKey);
            
            const allPressed = expectedCombo.every(key => {
                const checkKey = key.toLowerCase();
                return Array.from(pressedKeys).some(pk => pk.toLowerCase() === checkKey);
            });
            
            if (allPressed && pressedKeys.size >= expectedCombo.length) {
                document.removeEventListener('keydown', stage5ComboHandler);
                document.removeEventListener('keyup', stage5ComboKeyUp);
                clearInterval(timerInterval);
                
                // HÄ±z bonusu: Kalan sÃ¼re Ã— 25 puan (en zor etap)
                const speedBonus = timeRemaining * 25;
                handleCorrectAnswer(150 + speedBonus);
            } else if (pressedKeys.size >= expectedCombo.length) {
                // YanlÄ±ÅŸ kombinasyon - hemen hata ver
                document.removeEventListener('keydown', stage5ComboHandler);
                document.removeEventListener('keyup', stage5ComboKeyUp);
                clearInterval(timerInterval);
                handleWrongAnswer(Array.from(pressedKeys).join('+'));
            }
        }
        
        function stage5ComboKeyUp(e) {
            pressedKeys.delete(e.key.toLowerCase());
        }
        
        // ===== Ä°LK YÃœKLEMEDE =====
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Klavye UstasÄ± Oyunu YÃ¼klendi!');
        });
    </script>
</body>
</html>

<!-- 
===== GELÄ°ÅTÄ°RME NOTLARI & PEDAGOJÄ°K TERCÄ°HLER =====

1. TEK DOSYA MÄ°MARÄ°SÄ°:
   - TÃ¼m oyun tek bir HTML dosyasÄ±nda, CSS ve JavaScript gÃ¶mÃ¼lÃ¼ olarak yazÄ±ldÄ±
   - Sunucu gerektirmez, yerel tarayÄ±cÄ±da Ã§alÄ±ÅŸÄ±r
   - Basit daÄŸÄ±tÄ±m: dosyayÄ± aÃ§mak yeterli

2. 5 ETAPLI Ã–ÄRENÄ°M YOLU:
   - Etap 1: GÃ¶revden tuÅŸu bulma (kavramsal Ã¶ÄŸrenme)
   - Etap 2: GÃ¶rsel tanÄ±madan tuÅŸa basma (motor beceri)
   - Etap 3: DÃ¼ÅŸen tuÅŸlar arcade modu (hÄ±z ve refleks)
   - Etap 4: KÄ±sayol kombinasyonlarÄ±nÄ± uygulama (pratik beceri)
   - Etap 5: TanÄ±mdan kÄ±sayolu hatÄ±rlama (bilgi transferi)
   Bu sÄ±ralama Bloom Taksonomisi'ni takip eder: hatÄ±rlama â†’ uygulama â†’ analiz

3. ZORLUK DRECELENDÄ°RMESÄ°:
   - Her etapta seviye sistemi var, her 5-10 soruda zorluk artar
   - SÃ¼re sÄ±nÄ±rlarÄ± dinamik: baÅŸlangÄ±Ã§ta 25-30 saniye, seviye arttÄ±kÃ§a 15-20 saniyeye iner
   - Asla 8 saniyenin altÄ±na dÃ¼ÅŸmez (5. sÄ±nÄ±f Ã¶ÄŸrenciler iÃ§in uygun)
   - DÃ¼ÅŸen tuÅŸlar modunda dÃ¼ÅŸme hÄ±zÄ± ve spawn sÄ±klÄ±ÄŸÄ± kademeli artar

4. KLAVYE OLAY YÃ–NETÄ°MÄ°:
   - keydown ve keyup olaylarÄ± dinlenir
   - Kombinasyonlar iÃ§in Set veri yapÄ±sÄ± kullanÄ±lÄ±r (basÄ±lÄ± tuÅŸlar takip edilir)
   - Shift, Ctrl, Alt gibi modifier tuÅŸlar Ã¶zel olarak algÄ±lanÄ±r
   - Kombinasyon algÄ±lama: tuÅŸlarÄ±n 500ms iÃ§inde birlikte basÄ±lmasÄ± yeterli
   - CapsLock durumu dikkate alÄ±nÄ±r

5. GERÄ° BÄ°LDÄ°RÄ°M SÄ°STEMÄ°:
   - AnÄ±nda gÃ¶rsel geri bildirim: doÄŸru/yanlÄ±ÅŸ animasyonlarÄ±
   - Web Audio API ile doÄŸru/yanlÄ±ÅŸ/seviye atlama sesleri
   - Combo sistemi: 3+ ardÄ±ÅŸÄ±k doÄŸru cevap combo bonusu verir
   - Can sistemi: 3 hak, her yanlÄ±ÅŸ -1 can
   - Skor: kalan sÃ¼re Ã— 10 + combo bonusu

6. EÄÄ°TÄ°MSEL Ã–ZELLÄ°KLER:
   - Ã–ÄŸretmen paneli: sÃ¼re sÄ±nÄ±rÄ±nÄ± kaldÄ±rma, tuÅŸ adlarÄ±nÄ± gÃ¶sterme seÃ§enekleri
   - Oyun sonu raporu: hangi tuÅŸlarda zorlandÄ±ÄŸÄ±nÄ± gÃ¶sterir
   - Pratik modu: Ã¶ÄŸrenciler kendi hÄ±zlarÄ±nda Ã§alÄ±ÅŸabilir
   - Ses aÃ§ma/kapama seÃ§eneÄŸi (sÄ±nÄ±f ortamÄ± iÃ§in)

7. ERÄ°ÅÄ°LEBÄ°LÄ°RLÄ°K VE TASARIM:
   - BÃ¼yÃ¼k fontlar (5. sÄ±nÄ±f iÃ§in okunabilir)
   - YÃ¼ksek kontrast (mavi tonlarÄ±, beyaz arka plan)
   - Responsive tasarÄ±m (tablet ve masaÃ¼stÃ¼)
   - Renk kÃ¶rÃ¼ uyumlu: sadece renge deÄŸil metne de dayalÄ± geri bildirimler
   - Basit navigasyon, az buton

8. OYUNLAÅTIRMA:
   - Serbest ilerleme: tÃ¼m etaplar baÅŸtan aÃ§Ä±k
   - Seviye sistemi ve progress gÃ¶stergeleri
   - Combo ve skor bonuslarÄ±
   - Ä°statistik takibi ve baÅŸarÄ± rozetleri
   - Tekrar oynama teÅŸviki

9. TÃœRKÃ‡E KLAVÄ°E ODAKLI:
   - Q TÃ¼rkÃ§e klavye dÃ¼zeni baz alÄ±ndÄ±
   - TÃ¼rkÃ§e karakterler (Ã§, ÄŸ, Ä±, Ã¶, ÅŸ, Ã¼) dahil
   - MEB 5. sÄ±nÄ±f mÃ¼fredatÄ± ile uyumlu tuÅŸ listesi
   - Alt Gr karakterleri (@, â‚¬) belirtildi

10. PERFORMANS VE OPTÄ°MÄ°ZASYON:
    - Minimal baÄŸÄ±mlÄ±lÄ±k: saf HTML/CSS/JS
    - Hafif animasyonlar (CSS transitions)
    - Interval temizleme ve bellek yÃ¶netimi
    - DÃ¼ÅŸen tuÅŸlar iÃ§in eleman havuzu optimizasyonu
-->
